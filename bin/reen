#!/usr/bin/env ruby
# frozen_string_literal: true

EDITOR_MSG = "Editor not set in $EDITOR or $VISUAL -- please set one of those environment variables"

def exit_with_error(err)
  puts err
  exit(false)
end

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), *%w[.. lib])
require "reenrb"

file_list = ARGV || Dir.glob("*")
editor = ENV["VISUAL"] || ENV["EDITOR"] # rubocop:disable Style/FetchEnvVar
exit_with_error(EDITOR_MSG) if editor.empty?

results = Reenrb::Reen.new(editor: editor).execute(file_list)

changes = results.change_requested

puts changes.summarize
